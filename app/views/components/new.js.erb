<% content_for :wrapping_form do %>
	<%= form_for [@project, @component], :remote => true do |f|  %>
		<% content_for :tr do %>
			<%= render :partial => 'form_tr', :locals => {:f => f} %>
		<% end %>
	<% end %>
<% end %>

form = $("<%= escape_javascript( yield :wrapping_form) %>")
contents = form.children().detach();

$("tr.add_button").closest("table").wrap(form).append(contents);
$("tr.add_button").before("<%= escape_javascript( yield :tr ) %>");
$("tr.new_component > td.control").append("or <%= escape_javascript link_to( 'Cancel', [@project, @component] ) %>")
$("tr.add_button").hide();
$("input:text:visible:first").focus();