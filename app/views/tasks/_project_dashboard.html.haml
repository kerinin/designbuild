%table.tasks
  %tr
    %th Name
    %th.currency Est. Cost
    %th.currency Cost-to-Date
    %th.currency Projected Cost
    %th.number % Complete
    %th Deadline
    %th.control
    %th.control

  - [[tasks.active,'Active Tasks',(0..-1)], [tasks.completed, 'Completed Tasks',(0..5)], [tasks.future, 'Future Tasks',(0..5)]].each do |tasks, label, range|
    %tr
      %td{:colspan => 10}
        %i=label
      
    - tasks[range].each do |task|
      %tr{:id => "task_#{task.id}"}
        %td=link_to task.name, [@project, task]
        %td.currency= number_to_currency(task.estimated_cost)
        %td.currency= number_to_currency(task.cost)
        %td.currency= number_to_currency(task.projected_cost)
        %td.number= number_to_percentage( task.percent_complete, :precision => 0 )
        %td
          -if task.deadline.blank?
            Set Deadline:
            = link_to 'New', new_task_deadline_path(task, :context => 'tasks'), :remote => true
            or
            .inline
              =form_for [@project, task], :url => project_task_path(@project, task, :redirect_to => project_path(@project)) do |f|
                =f.collection_select :deadline_id, @project.deadlines, :id, :select_label_short, {:include_blank => 'Existing'}, :onchange => "$('#edit_task_#{task.id}').submit();"
          -else
            =link_to task.deadline.name, [@project, task.deadline]
            .inline
              = form_for [@project, task], :url => project_task_path(@project, task, :redirect_to => project_path(@project)) do |f|
                = f.hidden_field :deadline_id, :value => nil
                = f.submit 'Remove'
        %td.control= link_to "Log Hours", new_task_labor_cost_path(task, :context => :project), :remote => true
        %td.control= link_to "New Purchase Order", new_task_material_cost_path(task), :remote => true
      
    - if tasks.empty?
      %tr
        %td{:colspan => 10} (None)
  
  %tr.totals
    %td.right
      %strong Total
    %td.currency
      %strong= number_to_currency( @project.tasks.inject(nil) {|memo,t| add_or_nil(memo, t.estimated_cost ) } )
    %td.currency
      %strong= number_to_currency( @project.tasks.inject(nil) {|memo,t| add_or_nil(memo, t.cost ) } )
    %td.currency
      %strong= number_to_currency( @project.tasks.inject(nil) {|memo,t| add_or_nil(memo, t.projected_cost ) } )
    %td{:colspan => 5}

    

