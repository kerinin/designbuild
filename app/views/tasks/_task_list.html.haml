%table.tasks
  %tr
    %th Name
    %th.currency Est. Cost
    %th.currency Projected Cost
    %th.number % of Est.
    %th.number % Complete
    %th.control
    %th.control
    %th.control

  - tasks.each do |task|
    %tr{:id => "task_#{task.id}"}
      %td= task.name
      %td.currency= number_to_currency(task.estimated_cost)
      %td.currency= number_to_currency(task.projected_cost)
      %td.number= number_to_percentage( multiply_or_nil( 100, divide_or_nil(task.projected_cost, task.estimated_cost )), :precision => 1)
      %td.number= number_to_percentage( task.percent_complete, :precision => 0 )
      %td.control.show= link_to 'Show', [@project, task]
      %td.control.edit= link_to 'Rename', edit_project_task_path(@project, task), :remote => true
      %td.control.destroy= link_to 'Destroy', [@project, task], :confirm => 'Are you sure?', :method => :delete
      
  - if tasks.empty?
    %tr
      %td{:colspan => 10} (None)
      
  %tr.control.add_button
    %td{:colspan => 10}= link_to '(Add Task)', new_project_task_path(@project), :remote => true |
      
  %tr.totals
    %td
      %strong Total
    %td.currency
      %strong= number_to_currency( tasks.inject(0) {|memo,obj| add_or_nil memo, obj.estimated_cost })
    %td.currency
      %strong= number_to_currency( tasks.inject(0) {|memo,obj| add_or_nil memo, obj.cost })
    %td.number
      %strong= tasks.inject(0) {|memo,obj| add_or_nil memo, obj.estimated_cost} == 0 ? nil : number_to_percentage(100 * (tasks.inject(0) {|memo,obj| add_or_nil memo, obj.cost}) / (tasks.inject(0) {|memo,obj| add_or_nil memo, obj.estimated_cost}), :precision => 1)
    %td{:colspan => 4}
    

